"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[686],{4137:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=c(n),d=r,h=m["".concat(p,".").concat(d)]||m[d]||u[d]||o;return n?a.createElement(h,i(i({ref:t},s),{},{components:n})):a.createElement(h,i({ref:t},s))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3859:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(4137));const o={},i="Adding an event code",l={unversionedId:"Authorization/adding-event",id:"Authorization/adding-event",title:"Adding an event code",description:"There are two ways to add an event to the system:",source:"@site/docs/30-Authorization/30-adding-event.md",sourceDirName:"30-Authorization",slug:"/Authorization/adding-event",permalink:"/azure-openai-service-proxy/Authorization/adding-event",draft:!1,editUrl:"https://github.com/gloveboxes/azure-openai-service-proxy/tree/master/docs/docs/30-Authorization/30-adding-event.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Azure OpenAI rate limits",permalink:"/azure-openai-service-proxy/Authorization/openai-rate-limits"},next:{title:"OpenAI model deployments",permalink:"/azure-openai-service-proxy/openai-deployments"}},p={},c=[{value:"Using the Management API",id:"using-the-management-api",level:2},{value:"Using the Azure Storage Account <code>Storage browser</code>",id:"using-the-azure-storage-account-storage-browser",level:2},{value:"UTC Time",id:"utc-time",level:2},{value:"Example",id:"example",level:2},{value:"Event Code Cache",id:"event-code-cache",level:2}],s={toc:c},m="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(m,(0,a.Z)({},s,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"adding-an-event-code"},"Adding an event code"),(0,r.kt)("p",null,"There are two ways to add an event to the system:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Using the Management API (preferred)."),(0,r.kt)("li",{parentName:"ol"},"Using the Azure Storage Account ",(0,r.kt)("inlineCode",{parentName:"li"},"Storage browser"),".")),(0,r.kt)("h2",{id:"using-the-management-api"},"Using the Management API"),(0,r.kt)("p",null,"There is a Management API for adding events. The the path to the API is available from the url of the proxy service container. For example, if the proxy service is deployed to ",(0,r.kt)("inlineCode",{parentName:"p"},"https://myproxy.azurewebsites.net"),", then the Management API is available at ",(0,r.kt)("inlineCode",{parentName:"p"},"https://myproxy.azurewebsites.net/v1/management/addevent"),". This makes it easy to add events to the system using tools like ",(0,r.kt)("a",{parentName:"p",href:"https://www.microsoft.com/power-platform/products/power-automate"},"Power Automate")," or CLI tools like ",(0,r.kt)("a",{parentName:"p",href:"https://curl.se/"},"curl"),"."),(0,r.kt)("p",null,"The Management API is secured with the Managament ID token in the Azure OpenAI Proxy Storage Account ",(0,r.kt)("inlineCode",{parentName:"p"},"management")," table."),(0,r.kt)("p",null,"The following is an example of a ",(0,r.kt)("inlineCode",{parentName:"p"},"curl")," command to add an event to the system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'curl -X POST -H "Content-Type: application/json" -H "Authorization: Bearer YOUR_MANAGEMENT_ID" -d \'{\n    "event_name": ".NET OpenAI Hack",\n    "start_utc" : "2023-11-16T00:00:00",\n    "end_utc": "2023-12-16T00:00:00",\n    "max_token_cap": 2048,\n    "event_url": "http://www.example.com/event_name",\n    "event_url_text": "Join the .NET OpenAI Hack",\n    "organizer_name": "Ant Blogs",\n    "organizer_email": "ablogs@example.com"\n}\' https://YOUR_OPENAI_PROXY_ENDPOINT/v1/management/addevent | jq\n')),(0,r.kt)("h2",{id:"using-the-azure-storage-account-storage-browser"},"Using the Azure Storage Account ",(0,r.kt)("inlineCode",{parentName:"h2"},"Storage browser")),(0,r.kt)("p",null,"For now, you add an event via the Azure Storage Account ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage browser"),". The ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage browser")," is available in the Azure Portal, under the ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage account")," resource."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Select the Azure Storage Account resource, then select ",(0,r.kt)("inlineCode",{parentName:"li"},"Storage explorer (preview)")," from the left-hand menu, then select ",(0,r.kt)("inlineCode",{parentName:"li"},"Tables")," from the left-hand menu."),(0,r.kt)("li",{parentName:"ol"},"Next, select the ",(0,r.kt)("inlineCode",{parentName:"li"},"authorization")," table. "),(0,r.kt)("li",{parentName:"ol"},"Add an entry using the above schema, noting that the ",(0,r.kt)("inlineCode",{parentName:"li"},"PartitionKey")," must be set to ",(0,r.kt)("inlineCode",{parentName:"li"},"playground")," and the column names are case sensitive, and you must enter dates in ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/ISO_8601"},"ISO 8601")," format in UTC. ")),(0,r.kt)("h2",{id:"utc-time"},"UTC Time"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://www.worldtimebuddy.com"},"worldtimebuddy")," is a great time resource to convert your local time to UTC."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"The image is an example of ",src:n(3319).Z,width:"1014",height:"158"})),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)("p",null,"Here is an example"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"PartitionKey: event\nRowKey: myevent2022\nActive: true\nMaxTokenCap: 1024\nStartUTC: 2023-10-01T00:00:00Z\nEndUTC: 2023-10-02T00:00:00Z\nEventName: My Event 2023\nOrganizerName: John Smith\nOrganizerEmail: jsmith@example.com\n")),(0,r.kt)("h2",{id:"event-code-cache"},"Event Code Cache"),(0,r.kt)("p",null,"Event data, namely the ",(0,r.kt)("inlineCode",{parentName:"p"},"EventCode"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"StartUTC"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"EndUTC"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"MaxTokenCap")," are cached by the proxy service. The cache is refreshed every 10 minutes. Caching is implemented to improve performance by reducing the number of calls to the Azure Storage Account table. Because of caching, it may take up to 10 minutes for the changes to be reflected in the proxy service."))}u.isMDXComponent=!0},3319:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/world_time_buddy-cb051c158f79389a66c9d1781409624e.png"}}]);